{
  "name": "Dropbox → Airtable : Media Asset Auto‑Tagger",
  "nodes": [
    {
      "parameters": { "cronExpression": "0 * * * *" },
      "name": "Cron",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [250, 300][250, 300]
    },
    {
      "parameters": {
        "operation": "list",
        "path": "/media-library",
        "returnAll": true
      },
      "name": "Dropbox List",
      "type": "n8n-nodes-base.dropbox",
      "typeVersion": 1,
      "position": [450, 300][450, 300]
    },
    {
      "parameters": {
        "splitIntoBatches": true,
        "batchSize": 50
      },
      "name": "Batch Files",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [650, 300][650, 300]
    },
    {
      "parameters": {
        "functionCode": "const imageExt = ['.png','.jpg','.jpeg','.gif'];\nreturn items.filter(item => imageExt.some(ext => item.json.path_lower.endsWith(ext)));\n"
      },
      "name": "Filter Images",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 300][850, 300]
    },
    {
      "parameters": {
        "url": "https://<YOUR_COMPUTER_VISION_ENDPOINT>/analyze",
        "method": "POST",
        "jsonParameters": true,
        "options": {
          "bodyContentType": "json",
          "bodyParametersJson": "={\"url\":\"{{ $json.path_display }}\"}"
        },
        "authentication": "headerAuth",
        "headerAuth": {
          "name": "Ocp-Apim-Subscription-Key",
          "value": "YOUR_COMPUTER_VISION_KEY"
        }
      },
      "name": "Vision Tagging",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1050, 300][1050, 300]
    },
    {
      "parameters": {
        "operation": "upsert",
        "baseId": "YOUR_AIRTABLE_BASE_ID",
        "tableId": "tblAssets",
        "upsertKey": "DropboxPath",
        "fields": [
          { "fieldName": "FileName", "value": "={{$json.name}}" },
          { "fieldName": "DropboxPath", "value": "={{$json.path_display}}" },
          { "fieldName": "Tags", "value": "={{ $json.tags?.join(', ') || ''}}" },
          { "fieldName": "Link", "value": "={{'https://www.dropbox.com/home/media-library/' + $json.name}}" }
        ]
      },
      "name": "Airtable Upsert",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [1250, 300][1250, 300]
    }
  ],
  "connections": {
    "Cron": { "main": [["Dropbox List", "main"]] },
    "Dropbox List": { "main": [["Batch Files", "main"]] },
    "Batch Files": { "main": [["Filter Images", "main"]] },
    "Filter Images": { "main": [["Vision Tagging", "main"]] },
    "Vision Tagging": { "main": [["Airtable Upsert", "main"]] }
  }
}
